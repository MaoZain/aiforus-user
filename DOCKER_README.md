# AiForus Docker éƒ¨ç½²æŒ‡å—

è¿™ä¸ªé¡¹ç›®åŒ…å«äº†å®Œæ•´çš„ Docker å®¹å™¨åŒ–è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬å‰ç«¯ã€åç«¯å’Œæ•°æ®åº“ã€‚

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- Docker Engine 20.10 æˆ–æ›´é«˜ç‰ˆæœ¬
- Docker Compose 2.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- è‡³å°‘ 2GB å¯ç”¨ç£ç›˜ç©ºé—´

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®å¹¶è¿›å…¥ç›®å½•
```bash
cd /Users/maozain/projects/aiforus/aiforus_user
```

### 2. é…ç½®ç¯å¢ƒå˜é‡
ç¼–è¾‘ `backend/.env` æ–‡ä»¶ï¼Œè®¾ç½®ä½ çš„å®é™…é…ç½®ï¼š
```bash
# ç”Ÿäº§ç¯å¢ƒå»ºè®®ä¿®æ”¹è¿™äº›å€¼
JWT_SECRET=your_secure_jwt_secret_key
STRIPE_SECRET_KEY=your_stripe_secret_key
```

### 3. ä¸€é”®éƒ¨ç½²
```bash
chmod +x deploy.sh
# é¦–æ¬¡éƒ¨ç½²æˆ–éœ€è¦é‡å»ºæ—¶
./deploy.sh --build

# åç»­è¿è¡Œï¼ˆä½¿ç”¨ç¼“å­˜ï¼Œæ›´å¿«ï¼‰
./deploy.sh
```

æˆ–è€…æ‰‹åŠ¨æ‰§è¡Œï¼š
```bash
# é¦–æ¬¡æ„å»º
docker-compose up --build -d

# åç»­è¿è¡Œï¼ˆä½¿ç”¨ç¼“å­˜ï¼‰
docker-compose up -d
```

## ğŸŒ æœåŠ¡è®¿é—®

éƒ¨ç½²å®Œæˆåï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®å„ä¸ªæœåŠ¡ï¼š

- **å‰ç«¯åº”ç”¨**: http://localhost
- **åç«¯API**: http://localhost:3001
- **MySQLæ•°æ®åº“**: localhost:3306

## ğŸ“Š æœåŠ¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend      â”‚    â”‚    Backend      â”‚    â”‚     MySQL       â”‚
â”‚   (Vue.js)      â”‚â—„â”€â”€â–ºâ”‚   (Node.js)     â”‚â—„â”€â”€â–ºâ”‚   (Database)    â”‚
â”‚   Port: 3000    â”‚    â”‚   Port: 3001    â”‚    â”‚   Port: 3306    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ›  å¸¸ç”¨å‘½ä»¤

### æŸ¥çœ‹å®¹å™¨çŠ¶æ€
```bash
docker-compose ps
```

### æŸ¥çœ‹æœåŠ¡æ—¥å¿—
```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs -f backend
docker-compose logs -f frontend
docker-compose logs -f mysql
```

### é‡å¯æœåŠ¡
```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose restart

# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose restart backend
```

### åœæ­¢æœåŠ¡
```bash
docker-compose down
```

### é‡æ–°æ„å»ºå¹¶å¯åŠ¨
```bash
docker-compose up --build -d
```

### è¿›å…¥å®¹å™¨
```bash
# è¿›å…¥åç«¯å®¹å™¨
docker-compose exec backend sh

# è¿›å…¥æ•°æ®åº“å®¹å™¨
docker-compose exec mysql mysql -u aiforus -p aiforusdb
```

## ğŸ—„ æ•°æ®åº“é…ç½®

### è¿æ¥ä¿¡æ¯
- **ä¸»æœº**: localhost (å®¹å™¨é—´é€šä¿¡ä½¿ç”¨ `mysql`)
- **ç«¯å£**: 3306
- **æ•°æ®åº“**: aiforusdb
- **ç”¨æˆ·å**: aiforus
- **å¯†ç **: pass1234
- **Rootå¯†ç **: rootpassword123

### æ•°æ®æŒä¹…åŒ–
æ•°æ®åº“æ•°æ®å­˜å‚¨åœ¨ Docker volume `mysql_data` ä¸­ï¼Œå³ä½¿å®¹å™¨é‡å¯ä¹Ÿä¸ä¼šä¸¢å¤±æ•°æ®ã€‚

## ï¿½ æ„å»ºä¼˜åŒ–

### æ„å»ºç¼“å­˜
Docker ä¼šæ™ºèƒ½ç¼“å­˜æ„å»ºå±‚ï¼Œé¿å…ä¸å¿…è¦çš„é‡å¤æ„å»ºï¼š

- **é¦–æ¬¡æ„å»º**ï¼šä½¿ç”¨ `./deploy.sh --build` æˆ– `docker-compose up --build -d`
- **åç»­è¿è¡Œ**ï¼šä½¿ç”¨ `./deploy.sh` æˆ– `docker-compose up -d`ï¼ˆæ›´å¿«ï¼Œä½¿ç”¨ç¼“å­˜ï¼‰

### å¼ºåˆ¶é‡å»º
å¦‚æœä»£ç æˆ–ä¾èµ–å‘ç”Ÿå˜åŒ–ï¼Œéœ€è¦é‡å»ºï¼š
```bash
# é‡å»ºæ‰€æœ‰æœåŠ¡
./deploy.sh --build

# é‡å»ºç‰¹å®šæœåŠ¡
docker-compose build backend
docker-compose up -d
```

## ï¿½ğŸ”§ å¼€å‘æ¨¡å¼

å¦‚æœä½ æƒ³åœ¨å¼€å‘æ¨¡å¼ä¸‹è¿è¡Œï¼ˆä»£ç çƒ­é‡è½½ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹é…ç½®ï¼š

### åç«¯å¼€å‘æ¨¡å¼
```bash
# ä»…å¯åŠ¨æ•°æ®åº“
docker-compose up mysql -d

# åœ¨æœ¬åœ°è¿è¡Œåç«¯
cd backend
npm install
npm run dev
```

### å‰ç«¯å¼€å‘æ¨¡å¼
```bash
cd frontend
npm install
npm run dev
```

## ğŸ“ ç¯å¢ƒå˜é‡è¯´æ˜

### åç«¯ç¯å¢ƒå˜é‡ (`backend/.env`)
```env
NODE_ENV=production          # è¿è¡Œç¯å¢ƒ
DB_HOST=mysql               # æ•°æ®åº“ä¸»æœº
DB_USER=aiforus             # æ•°æ®åº“ç”¨æˆ·
DB_PASSWORD=pass1234        # æ•°æ®åº“å¯†ç 
DB_NAME=aiforusdb           # æ•°æ®åº“å
JWT_SECRET=your_jwt_secret   # JWTå¯†é’¥
STRIPE_SECRET_KEY=sk_xxx     # Stripeå¯†é’¥
PORT=3001                   # åç«¯ç«¯å£
```

## ğŸ”’ å®‰å…¨å»ºè®®

1. **ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰**ï¼š
   - ä¿®æ”¹æ‰€æœ‰é»˜è®¤å¯†ç 
   - ä½¿ç”¨å¼ºJWTå¯†é’¥
   - é…ç½®HTTPS
   - è®¾ç½®é˜²ç«å¢™è§„åˆ™

2. **æ•°æ®åº“å®‰å…¨**ï¼š
   - ä¿®æ”¹é»˜è®¤å¯†ç 
   - é™åˆ¶è®¿é—®IP
   - å®šæœŸå¤‡ä»½æ•°æ®

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£å†²çª**
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   lsof -i :80
   lsof -i :3001
   lsof -i :3306
   ```

2. **æƒé™é—®é¢˜**
   ```bash
   # ç¡®ä¿deploy.shæœ‰æ‰§è¡Œæƒé™
   chmod +x deploy.sh
   ```

3. **å®¹å™¨å¯åŠ¨å¤±è´¥**
   ```bash
   # æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
   docker-compose logs
   ```

4. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥æ•°æ®åº“å®¹å™¨çŠ¶æ€
   docker-compose exec mysql mysql -u root -p -e "SHOW DATABASES;"
   ```

### æ¸…ç†å’Œé‡ç½®

```bash
# åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰å®¹å™¨
docker-compose down

# åˆ é™¤æ‰€æœ‰é•œåƒ
docker-compose down --rmi all

# åˆ é™¤æ•°æ®å·ï¼ˆæ³¨æ„ï¼šè¿™ä¼šåˆ é™¤æ‰€æœ‰æ•°æ®ï¼‰
docker-compose down -v
```

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. Docker å’Œ docker-compose ç‰ˆæœ¬
2. ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
3. ç½‘ç»œè¿æ¥çŠ¶æ€
4. æ—¥å¿—æ–‡ä»¶ä¸­çš„é”™è¯¯ä¿¡æ¯
